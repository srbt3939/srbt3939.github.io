<svg width="700" height="300">
  <!-- AWSノード -->
  <image id="sqs" href="sqs.svg" x="50" y="100" width="80" height="80"/>
  <image id="lambda" href="lambda.svg" x="500" y="100" width="80" height="80"/>

  <!-- 矢印 -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#333"/>
    </marker>
  </defs>
  <path id="flow" d="M130,140 C250,50 400,200 500,140"
        stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)"/>

  <!-- メッセージを複数配置（SQSキューのイメージ） -->
  <rect class="msg" x="60" y="200" width="30" height="20" fill="skyblue" stroke="black"/>
  <rect class="msg" x="100" y="200" width="30" height="20" fill="lightgreen" stroke="black"/>
  <rect class="msg" x="140" y="200" width="30" height="20" fill="orange" stroke="black"/>
  <rect class="msg" x="180" y="200" width="30" height="20" fill="pink" stroke="black"/>
</svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  const path = d3.select("#flow").node();
  const totalLength = path.getTotalLength();
  const lambdaIcon = d3.select("#lambda");

  function sendMessage(msg, delay) {
    d3.select(msg)
      .transition()
      .delay(delay)
      .duration(3000)
      .attrTween("transform", () => t => {
        const p = path.getPointAtLength(t * totalLength);
        return `translate(${p.x - msg.x.baseVal.value},${p.y - msg.y.baseVal.value})`;
      })
      .on("end", () => {
        // Lambdaが点滅して処理している演出
        lambdaIcon
          .transition().duration(200).style("opacity", 0.3)
          .transition().duration(200).style("opacity", 1);
        // メッセージを消す（処理完了）
        d3.select(msg).remove();
      });
  }

  // メッセージを順番に流す（1秒間隔でスタート）
  d3.selectAll(".msg").nodes().forEach((msg, i) => {
    sendMessage(msg, i * 1000);
  });
</script>
